<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Sistema</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Controle de Sistema</h1>

    <label for="modo">Modo de Operação:</label>
    <select id="modo" onchange="ajustarVisibilidadeTempo()">
        <option value="continua">Contínua</option>
        <option value="digital">Digital</option>
    </select>

    <div id="tempoDiv" style="display: none;">
        <label for="tempo">Tempo (segundos):</label>
        <input type="number" id="tempo" step="0.1" min="0">
    </div><br>

    <label for="kp">Kp:</label>
    <input type="number" id="kp" readonly>
    <button onclick="salvarValor('kp')">Salvar Kp</button><br>

    <label for="kd">Kd:</label>
    <input type="number" id="kd" readonly>
    <button onclick="salvarValor('kd')">Salvar Kd</button><br>

    <label for="ki">Ki:</label>
    <input type="number" id="ki" readonly>
    <button onclick="salvarValor('ki')">Salvar Ki</button><br>

    <label for="tau">Tau:</label>
    <input type="number" id="tau" step="0.01"><br>

    <label for="qsi">Qsi:</label>
    <input type="number" id="qsi" step="0.01"><br>

    <button onclick="enviarValores()">Enviar</button>

    <script>
        function ajustarVisibilidadeTempo() {
            var modo = document.getElementById("modo").value;
            var tempoDiv = document.getElementById("tempoDiv");
            if (modo === "digital") {
                tempoDiv.style.display = "block";
            } else {
                tempoDiv.style.display = "none";
            }
        }

        function salvarValor(param) {
            var valor = document.getElementById(param).value;
            $.ajax({
                url: `/salvar-${param}`,
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ valor: valor }),
                success: function(response) {
                    alert(param.toUpperCase() + ' salvo com sucesso!');
                }
            });
        }

        function enviarValores() {
            var modo = document.getElementById("modo").value;
            var tempo = document.getElementById("tempo").value;
            var tau = document.getElementById("tau").value;
            var qsi = document.getElementById("qsi").value;

            $.ajax({
                url: '/enviar-valores',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({
                    modo: modo,
                    tempo: tempo,
                    tau: tau,
                    qsi: qsi
                }),
                success: function(response) {
                    alert('Valores enviados com sucesso!');
                }
            });
        }

        function atualizarPotenciometro() {
            $.ajax({
                url: '/atualizar-potenciometro',
                type: 'GET',
                success: function(response) {
                    $('#kp').val(response.valor);
                    $('#kd').val(response.valor);
                    $('#ki').val(response.valor);
                }
            });
        }

        setInterval(atualizarPotenciometro, 1000); // Atualiza a cada 1 segundo
    </script>
</body>
</html>
